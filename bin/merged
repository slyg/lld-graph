#!/bin/bash

dist="dist"
viz_type="dot"
target="$dist/merged.dot"

mkdir -p $dist

echo -e "digraph {\nranksep=3; ratio=auto; overlap=false;\nnode [ shape = plaintext, fontname = \"Helvetica\" ];" > $target

curl \
    https://pact-broker.platform.hmcts.net/pacts/latest \
    | jq -f './queries/merged.jq' \
    | jq '.[] | .consumer + "->" + .provider' \
    | tr -d '"' \
    | sed 's/-/_/g' \
    | sed 's/_>/->/g' \
    >> $target

echo "}" >> $target

$viz_type $target -o $dist/merged-diagram.png -T png
