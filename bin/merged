#!/bin/bash
. .env
source lib/create_dot_with.sh
source lib/create_diagram.sh

dot_file="dist/merged.dot"
png_file="dist/merged-diagram.png"

mkdir -p dist

relations=$(curl \
    $BROKER_URL \
    | jq -f './queries/merged.jq' \
    | jq '.[] | .consumer + "->" + .provider' \
    | tr -d '"')

create_dot_with $relations > $dot_file
create_diagram $dot_file $png_file
